const Socket = require('../index');
const Config = require('./config.test');

async function test() {
  let options = {
    apiKey: Config.API_KEY,
    secret: Config.SECRECT,
    authUrl: Config.AUTH_URL,
    baseUrl: Config.BASE_URL
  };

  let socket = new Socket(options);
  await socket.connect(() => {
    let block = socket.Block;
    let tx = socket.Tx;

    block.subscribe({
      coins: ['BTC', 'ETH']
    });
    block.on((data) => {
      console.log(data);
    });

    tx.subscribe({
      coins: ['BTC', 'ETH']
    });
    tx.on((data) => {
      console.log(data);
    });

    setTimeout(() => {
      tx.unsubscribe({
        coins: ['BTC', 'ETH']
      });

      setTimeout(() => {
        tx.subscribe({
          coins: ['BTC', 'ETH']
        });
      }, 5000);
    }, 20000);
  });

  socket.error((error) => {
    console.log('error' + error);
  });

  socket.disconnect(() => {
    console.log('disconnect');
  });
}

test().then((data) => {
  console.log(data);
});